<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping List</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for matching the image */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Light blue-gray background */
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 0; /* Remove body padding to allow full width content */
        }
        .container {
            background-color: #ffffff;
            max-width: 600px; /* Constrain width for desktop, but allow full width on mobile */
            width: 100%;
            min-height: 100vh; /* Ensure it takes full height on mobile */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.05); /* Subtle shadow for the main content area */
        }

        /* Header styling */
        .header {
            background-color: #ffffff;
            padding: 1rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .header-title {
            font-weight: 600;
            font-size: 1.25rem; /* text-xl */
            color: #1e293b;
        }
        .header-icon {
            width: 24px;
            height: 24px;
            color: #64748b; /* Slate gray */
            cursor: pointer;
        }

        /* Item styling */
        .item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e2e8f0;
            background-color: #ffffff;
        }
        .item:last-of-type {
            border-bottom: none; /* No border for the last item in a list */
        }
        .item label {
            display: flex;
            align-items: center;
            flex-grow: 1;
            cursor: pointer;
            font-size: 1.05rem; /* Slightly larger font size */
            color: #334155; /* Darker text */
        }
        .item-quantity {
            font-size: 0.875rem; /* text-sm */
            color: #64748b; /* Slate gray */
            margin-right: 0.5rem;
        }
        .item-add-icon { /* Renamed from item-drag-icon */
            width: 24px;
            height: 24px;
            color: #94a3b8; /* Lighter gray */
            cursor: pointer; /* Changed to pointer */
            margin-left: 0.75rem; /* Space from foldable arrow or label */
        }

        /* Custom input base styles */
        .custom-input {
            appearance: none; /* Hide default browser styles */
            width: 24px;
            height: 24px;
            border: 2px solid #9ca3af; /* Gray border for unchecked state */
            cursor: pointer;
            position: relative;
            display: inline-block;
            transition: all 0.2s ease-in-out;
            flex-shrink: 0; /* Prevent shrinking */
        }

        /* Checkbox specific styling: always square */
        input[type="checkbox"].custom-input {
            border-radius: 0.375rem; /* rounded-md for square shape */
        }

        /* Checked checkbox state */
        input[type="checkbox"].custom-input:checked {
            background-color: #22c55e; /* Green background */
            border-color: #22c55e; /* Green border */
        }

        /* Checkmark for checked checkbox state */
        input[type="checkbox"].custom-input:checked::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 12px; /* Checkmark size */
            height: 6px;
            border-left: 2px solid white;
            border-bottom: 2px solid white;
            transform: translate(-50%, -50%) rotate(-45deg); /* Rotate for checkmark shape */
        }

        /* Radio button specific styling: always round */
        input[type="radio"].custom-input {
            border-radius: 9999px; /* Full rounded for circle */
        }

        /* Checked radio button state */
        input[type="radio"].custom-input:checked {
            background-color: #4f46e5; /* Indigo background for the outer circle */
            border-color: #4f46e5;
        }

        /* Inner dot for checked radio button state */
        input[type="radio"].custom-input:checked::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 10px; /* Inner dot size */
            height: 10px;
            background-color: white;
            border-radius: 9999px;
            transform: translate(-50%, -50%);
            border: none; /* No border for the inner dot */
        }

        /* Foldable arrow icon for parent items */
        .fold-arrow-icon {
            width: 20px;
            height: 20px;
            color: #64748b;
            cursor: pointer;
            transition: transform 0.2s ease-in-out;
            margin-left: auto; /* Push to the right before add icon */
        }
        .fold-arrow-icon.rotated {
            transform: rotate(-90deg); /* Rotate when collapsed */
        }

        /* Children group container for folding and indentation */
        .children-group {
            padding-left: 2rem; /* Indent the entire group of children */
            overflow: hidden; /* Hide overflow when collapsed */
            transition: max-height 0.3s ease-out; /* Smooth transition for folding */
            max-height: 500px; /* Default max height when expanded (adjust as needed) */
        }
        .children-group.collapsed {
            max-height: 0; /* Collapse by setting max-height to 0 */
        }

        /* Vertical line and horizontal connector for child items */
        .item.child {
            position: relative;
        }

        .item.child::before { /* Vertical line */
            content: '';
            position: absolute;
            top: 0;
            left: -1rem; /* Position relative to the child's own box, pushing it into the parent's padding */
            width: 2px;
            height: 100%;
            background-color: #cbd5e1; /* Light gray line */
            z-index: 1;
        }

        .item.child::after { /* Horizontal connector line */
            content: '';
            position: absolute;
            top: 1.2rem; /* Adjust to visually align with checkbox */
            left: -1rem; /* Same as the vertical line */
            width: 1rem; /* Length of the horizontal line, extending to the checkbox */
            height: 2px;
            background-color: #cbd5e1;
            z-index: 1;
        }

        /* Summary section */
        .summary-section {
            background-color: #ffffff;
            padding: 1rem;
            border-top: 1px solid #e2e8f0;
            margin-top: 1rem; /* Space from the list */
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* Three columns */
            gap: 0.5rem;
            text-align: center;
        }
        .summary-col {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .summary-label {
            font-size: 0.875rem; /* text-sm */
            color: #64748b;
            margin-bottom: 0.25rem;
        }
        .summary-value {
            font-size: 1.125rem; /* text-lg */
            font-weight: 600;
            color: #1e293b;
        }
        .summary-total-col {
            position: relative;
        }
        .summary-total-col .item-add-icon { /* Updated class name */
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
        }

        /* Hide checked items button */
        .hide-checked-button {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1rem;
            background-color: #ffffff;
            border-top: 1px solid #e2e8f0;
            cursor: pointer;
            font-size: 0.95rem;
            color: #64748b;
            margin-bottom: 1rem; /* Space from bottom */
        }
        .hide-checked-button svg {
            width: 20px;
            height: 20px;
            margin-left: 0.5rem;
            transition: transform 0.2s ease-in-out;
        }
        .hide-checked-button.collapsed svg {
            transform: rotate(180deg); /* Rotate arrow when collapsed */
        }

        /* Hide checked items logic */
        .item.checked-hidden {
            display: none;
        }

        /* Modal styling */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: #ffffff;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 300px;
            width: 90%;
        }
        .modal-content h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: #1e293b;
        }
        .modal-buttons {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .modal-button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
        }
        .modal-button.primary {
            background-color: #4f46e5;
            color: #ffffff;
        }
        .modal-button.primary:hover {
            background-color: #4338ca;
        }
        .modal-button.secondary {
            background-color: #e2e8f0;
            color: #334155;
        }
        .modal-button.secondary:hover {
            background-color: #cbd5e1;
        }
    </style>
</head>
<body class="antialiased">
    <div class="container">
        <div class="header">
            <svg class="header-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
            <span class="header-title">Supermercado</span>
            <div class="flex items-center">
                <svg class="header-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"></path></svg>
            </div>
        </div>

        <div class="list-items" id="list-items-container">
            <div class="item parent" data-id="task-1">
                <label for="task-1-checkbox">
                    <input type="checkbox" id="task-1-checkbox" class="custom-input">
                    <span class="ml-4">Project Alpha (Parent)</span>
                </label>
                <div class="flex items-center">
                    <svg class="fold-arrow-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    <svg class="item-add-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                </div>
            </div>
            <div class="children-group" data-parent-of="task-1">
                <div class="item child" data-id="subtask-1-1" data-parent-id="task-1">
                    <label for="subtask-1-1-checkbox">
                        <input type="checkbox" id="subtask-1-1-checkbox" class="custom-input">
                        <span class="ml-4">Design UI</span>
                    </label>
                    <span class="item-quantity"></span>
                    <svg class="item-add-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                </div>
                <div class="item child" data-id="subtask-1-2" data-parent-id="task-1">
                    <label for="subtask-1-2-checkbox">
                        <input type="checkbox" id="subtask-1-2-checkbox" class="custom-input">
                        <span class="ml-4">Develop Backend</span>
                    </label>
                    <span class="item-quantity"></span>
                    <svg class="item-add-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                </div>
                <div class="item child" data-id="subtask-1-3" data-parent-id="task-1">
                    <label for="subtask-1-3-checkbox">
                        <input type="checkbox" id="subtask-1-3-checkbox" class="custom-input">
                        <span class="ml-4">Write Tests</span>
                    </label>
                    <span class="item-quantity"></span>
                    <svg class="item-add-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                </div>
                <div class="item child" data-id="subtask-1-4" data-parent-id="task-1">
                    <label for="subtask-1-4-radio">
                        <input type="radio" name="subtask-1-radio" id="subtask-1-4-radio" class="custom-input">
                        <span class="ml-4">Choose Option A (Radio)</span>
                    </label>
                    <span class="item-quantity"></span>
                    <svg class="item-add-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                </div>
                <div class="item child" data-id="subtask-1-5" data-parent-id="task-1">
                    <label for="subtask-1-5-radio">
                        <input type="radio" name="subtask-1-radio" id="subtask-1-5-radio" class="custom-input">
                        <span class="ml-4">Choose Option B (Radio)</span>
                    </label>
                    <span class="item-quantity"></span>
                    <svg class="item-add-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                </div>
            </div>

            <div class="item parent" data-id="task-2">
                <label for="task-2-checkbox">
                    <input type="checkbox" id="task-2-checkbox" class="custom-input">
                    <span class="ml-4">Marketing Campaign (Parent)</span>
                </label>
                <div class="flex items-center">
                    <svg class="fold-arrow-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    <svg class="item-add-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                </div>
            </div>
            <div class="children-group" data-parent-of="task-2">
                <div class="item child" data-id="subtask-2-1" data-parent-id="task-2">
                    <label for="subtask-2-1-checkbox">
                        <input type="checkbox" id="subtask-2-1-checkbox" class="custom-input">
                        <span class="ml-4">Create Ad Copy</span>
                    </label>
                    <span class="item-quantity"></span>
                    <svg class="item-add-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                </div>
                <div class="item child" data-id="subtask-2-2" data-parent-id="task-2">
                    <label for="subtask-2-2-checkbox">
                        <input type="checkbox" id="subtask-2-2-checkbox" class="custom-input">
                        <span class="ml-4">Schedule Social Media</span>
                    </label>
                    <span class="item-quantity"></span>
                    <svg class="item-add-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                </div>
            </div>

            <div class="item parent" data-id="task-3">
                <label for="task-3-checkbox">
                    <input type="checkbox" id="task-3-checkbox" class="custom-input">
                    <span class="ml-4">Survey Options (Parent)</span>
                </label>
                <div class="flex items-center">
                    <svg class="fold-arrow-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    <svg class="item-add-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                </div>
            </div>
            <div class="children-group" data-parent-of="task-3">
                <div class="item child" data-id="subtask-3-1" data-parent-id="task-3">
                    <label for="subtask-3-1-radio">
                        <input type="radio" name="subtask-3-radio" id="subtask-3-1-radio" class="custom-input">
                        <span class="ml-4">Option X (Radio)</span>
                    </label>
                    <span class="item-quantity"></span>
                    <svg class="item-add-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                </div>
                <div class="item child" data-id="subtask-3-2" data-parent-id="task-3">
                    <label for="subtask-3-2-radio">
                        <input type="radio" name="subtask-3-radio" id="subtask-3-2-radio" class="custom-input">
                        <span class="ml-4">Option Y (Radio)</span>
                    </label>
                    <span class="item-quantity"></span>
                    <svg class="item-add-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                </div>
            </div>

            <div class="item" data-id="huevos">
                <label for="item-huevos">
                    <input type="checkbox" id="item-huevos" class="custom-input">
                    <span class="ml-4">Huevos</span>
                </label>
                <span class="item-quantity"></span>
                <svg class="item-add-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
            </div>
            <div class="item" data-id="mantequilla">
                <label for="item-mantequilla">
                    <input type="checkbox" id="item-mantequilla" class="custom-input">
                    <span class="ml-4">Mantequilla Soprole Pote</span>
                </label>
                <span class="item-quantity"></span>
                <svg class="item-add-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
            </div>
            <div class="item" data-id="queso">
                <label for="item-queso">
                    <input type="checkbox" id="item-queso" class="custom-input">
                    <span class="ml-4">Queso</span>
                </label>
                <span class="item-quantity">2g</span>
                <svg class="item-add-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
            </div>
            <div class="item" data-id="yoghurt">
                <label for="item-yoghurt">
                    <input type="checkbox" id="item-yoghurt" class="custom-input">
                    <span class="ml-4">Yoghurt Gold</span>
                </label>
                <span class="item-quantity">2</span>
                <svg class="item-add-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
            </div>
            <div class="item" data-id="atun">
                <label for="item-atun">
                    <input type="checkbox" id="item-atun" class="custom-input">
                    <span class="ml-4">Atún Lata Lomito</span>
                </label>
                <span class="item-quantity"></span>
                <svg class="item-add-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
            </div>
            <div class="item" data-id="avena">
                <label for="item-avena">
                    <input type="checkbox" id="item-avena" class="custom-input">
                    <span class="ml-4">Avena Quaker Tradicional</span>
                </label>
                <span class="item-quantity"></span>
                <svg class="item-add-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
            </div>

            <div class="item" data-id="leche">
                <label for="item-leche">
                    <input type="checkbox" id="item-leche" class="custom-input" checked>
                    <span class="ml-4">Leche en polvo entera</span>
                </label>
                <span class="item-quantity"></span>
                <svg class="item-add-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
            </div>
            <div class="item" data-id="pan">
                <label for="item-pan">
                    <input type="checkbox" id="item-pan" class="custom-input" checked>
                    <span class="ml-4">Pan Molde Blanco o Integral Ideal 750g</span>
                </label>
                <span class="item-quantity">1</span>
                <svg class="item-add-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
            </div>

        </div>

        <div class="summary-section">
            <div class="summary-col">
                <span class="summary-label">Unchecked</span>
                <span class="summary-value">$ 18.490,00</span>
            </div>
            <div class="summary-col">
                <span class="summary-label">Checked</span>
                <span class="summary-value">$ 2.290,00</span>
            </div>
            <div class="summary-col summary-total-col">
                <span class="summary-label">Total</span>
                <span class="summary-value">$ 20.780,00</span>
                <svg class="item-add-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"></path></svg>
            </div>
        </div>

        <div class="hide-checked-button" id="hideCheckedButton">
            <span id="hideCheckedText">(2) Hide checked items</span>
            <svg id="hideCheckedArrow" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
        </div>

    </div>

    <div class="modal-overlay" id="addItemModal">
        <div class="modal-content">
            <h3>Add New Item</h3>
            <div class="modal-buttons">
                <button class="modal-button primary" id="addCheckboxItem">Add Checkbox Item</button>
                <button class="modal-button secondary" id="addRadioItem">Add Radio Item</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const listItemsContainer = document.getElementById('list-items-container');
            const hideCheckedButton = document.getElementById('hideCheckedButton');
            const hideCheckedText = document.getElementById('hideCheckedText');
            const hideCheckedArrow = document.getElementById('hideCheckedArrow');
            const addItemModal = document.getElementById('addItemModal');
            const addCheckboxItemButton = document.getElementById('addCheckboxItem');
            const addRadioItemButton = document.getElementById('addRadioItem');
            let checkedItemsHidden = false; // State to track if checked items are hidden

            let currentAddItemTarget = null; // Stores the item element next to which the new item will be added

            // --- Initial Setup ---
            attachEventListeners(); // Attach event listeners to initial items
            updateHideCheckedCount(); // Initial update of the hide checked items count

            // --- Event Listeners ---

            /**
             * Attaches all necessary event listeners to the items.
             * This function is called on DOMContentLoaded and after adding new items.
             */
            function attachEventListeners() {
                // Remove existing listeners to prevent duplicates
                document.querySelectorAll('input[type="checkbox"], input[type="radio"]').forEach(input => {
                    input.removeEventListener('change', handleInputChange);
                });
                document.querySelectorAll('.item.parent').forEach(parentItem => {
                    parentItem.removeEventListener('click', handleParentClick);
                    const foldArrow = parentItem.querySelector('.fold-arrow-icon');
                    if (foldArrow) foldArrow.removeEventListener('click', handleFoldArrowClick);
                });
                document.querySelectorAll('.item-add-icon').forEach(icon => {
                    icon.removeEventListener('click', handleAddIconClick);
                });


                // Add change event listener to each input
                document.querySelectorAll('input[type="checkbox"], input[type="radio"]').forEach(input => {
                    input.addEventListener('change', handleInputChange);
                });

                // Add click listeners for parent items to toggle folding
                document.querySelectorAll('.item.parent').forEach(parentItem => {
                    parentItem.addEventListener('click', handleParentClick);
                    const foldArrow = parentItem.querySelector('.fold-arrow-icon');
                    if (foldArrow) {
                        foldArrow.addEventListener('click', handleFoldArrowClick);
                    }
                });

                // Add click listeners for add icons
                document.querySelectorAll('.item-add-icon').forEach(icon => {
                    icon.addEventListener('click', handleAddIconClick);
                });
            }

            // Centralized handlers for re-attaching listeners
            function handleInputChange(event) {
                const changedInput = event.target;
                const parentElement = changedInput.closest('.item');
                const parentId = parentElement.dataset.id;
                const isParent = parentElement.classList.contains('parent');

                if (isParent) {
                    handleParentChange(changedInput, parentId);
                } else {
                    const childParentId = parentElement.dataset.parentId;
                    if (childParentId) {
                        handleChildChange(changedInput, childParentId);
                    }
                }
                updateHideCheckedCount();
            }

            function handleParentClick(event) {
                if (!event.target.closest('input') && !event.target.closest('.item-add-icon')) {
                    toggleParentFolding(event.currentTarget);
                }
            }

            function handleFoldArrowClick(event) {
                event.stopPropagation();
                toggleParentFolding(event.currentTarget.closest('.item.parent'));
            }

            function handleAddIconClick(event) {
                event.stopPropagation(); // Prevent parent item's click listener
                currentAddItemTarget = event.currentTarget.closest('.item');
                addItemModal.classList.add('active');
            }

            // Add click listener for the hide checked items button
            hideCheckedButton.addEventListener('click', toggleCheckedItemsVisibility);

            // Modal button listeners
            addCheckboxItemButton.addEventListener('click', () => {
                addNewItem('checkbox');
                addItemModal.classList.remove('active');
            });

            addRadioItemButton.addEventListener('click', () => {
                addNewItem('radio');
                addItemModal.classList.remove('active');
            });

            // Close modal if clicked outside content
            addItemModal.addEventListener('click', (event) => {
                if (event.target === addItemModal) {
                    addItemModal.classList.remove('active');
                }
            });


            // --- Functions ---

            /**
             * Handles the change event for a parent checkbox.
             * When a parent is checked/unchecked, its children are affected.
             * @param {HTMLInputElement} parentCheckbox The parent checkbox that changed.
             * @param {string} parentId The data-id of the parent.
             */
            function handleParentChange(parentCheckbox, parentId) {
                const childrenContainer = document.querySelector(`.children-group[data-parent-of="${parentId}"]`);
                if (!childrenContainer) {
                    return;
                }

                const childInputs = childrenContainer.querySelectorAll('input[type="checkbox"], input[type="radio"]');
                childInputs.forEach(childInput => {
                    if (childInput.type === 'checkbox') {
                        childInput.checked = parentCheckbox.checked;
                        if (checkedItemsHidden) {
                            childInput.closest('.item').classList.add('checked-hidden');
                        } else {
                             childInput.closest('.item').classList.remove('checked-hidden');
                        }
                    }
                });
            }

            /**
             * Handles the change event for a child checkbox or radio.
             * When a child is changed, its parent's state might be affected.
             * @param {HTMLInputElement} childInput The child input that changed.
             * @param {string} parentId The data-parent-id of the child, linking it to its parent.
             */
            function handleChildChange(childInput, parentId) {
                const parentCheckbox = document.querySelector(`.item.parent[data-id="${parentId}"] input[type="checkbox"]`);
                if (!parentCheckbox) {
                    return;
                }

                const childrenContainer = document.querySelector(`.children-group[data-parent-of="${parentId}"]`);
                if (!childrenContainer) {
                    return;
                }
                const allChildren = Array.from(childrenContainer.querySelectorAll('input[type="checkbox"], input[type="radio"]'));

                const checkboxChildren = allChildren.filter(input => input.type === 'checkbox');
                const allCheckboxChildrenChecked = checkboxChildren.length > 0 && checkboxChildren.every(input => input.checked);

                parentCheckbox.checked = allCheckboxChildrenChecked;

                if (childInput.type === 'checkbox') {
                    const itemElement = childInput.closest('.item');
                    if (checkedItemsHidden && childInput.checked) {
                        itemElement.classList.add('checked-hidden');
                    } else {
                        itemElement.classList.remove('checked-hidden');
                    }
                }
            }

            /**
             * Toggles the visibility of checked items.
             */
            function toggleCheckedItemsVisibility() {
                checkedItemsHidden = !checkedItemsHidden;
                const checkedItems = document.querySelectorAll('.item input[type="checkbox"]:checked');

                checkedItems.forEach(input => {
                    const itemElement = input.closest('.item');
                    if (checkedItemsHidden) {
                        itemElement.classList.add('checked-hidden');
                    } else {
                        itemElement.classList.remove('checked-hidden');
                    }
                });

                updateHideCheckedCount();
                hideCheckedButton.classList.toggle('collapsed', checkedItemsHidden);
            }

            /**
             * Toggles the collapsed state of a parent item's children.
             * @param {HTMLElement} parentItem The parent item element.
             */
            function toggleParentFolding(parentItem) {
                const parentId = parentItem.dataset.id;
                const childrenGroup = document.querySelector(`.children-group[data-parent-of="${parentId}"]`);
                const foldArrow = parentItem.querySelector('.fold-arrow-icon');

                if (childrenGroup && foldArrow) {
                    childrenGroup.classList.toggle('collapsed');
                    foldArrow.classList.toggle('rotated', childrenGroup.classList.contains('collapsed'));
                }
            }

            /**
             * Adds a new item (checkbox or radio) to the list as a child of the currentAddItemTarget.
             * If currentAddItemTarget is not a parent, it becomes one.
             * @param {string} type 'checkbox' or 'radio'.
             */
            function addNewItem(type) {
                if (!currentAddItemTarget) return;

                const newItemId = 'item-' + Date.now();
                const targetItemId = currentAddItemTarget.dataset.id;
                let targetChildrenGroup = document.querySelector(`.children-group[data-parent-of="${targetItemId}"]`);

                // If the target item is not yet a parent or doesn't have a children-group
                if (!currentAddItemTarget.classList.contains('parent') || !targetChildrenGroup) {
                    // Make the currentAddItemTarget a parent
                    currentAddItemTarget.classList.add('parent');

                    // Add the fold arrow icon if it's not already there
                    let foldArrow = currentAddItemTarget.querySelector('.fold-arrow-icon');
                    if (!foldArrow) {
                        const flexContainer = currentAddItemTarget.querySelector('.flex.items-center');
                        if (flexContainer) {
                            foldArrow = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                            foldArrow.classList.add('fold-arrow-icon');
                            foldArrow.setAttribute('fill', 'none');
                            foldArrow.setAttribute('stroke', 'currentColor');
                            foldArrow.setAttribute('viewBox', '0 0 24 24');
                            foldArrow.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>';
                            // Insert before the add icon
                            const addIcon = flexContainer.querySelector('.item-add-icon');
                            if (addIcon) {
                                flexContainer.insertBefore(foldArrow, addIcon);
                            } else {
                                flexContainer.appendChild(foldArrow); // Fallback
                            }
                        }
                    }

                    // Create a new children-group for this new parent
                    targetChildrenGroup = document.createElement('div');
                    targetChildrenGroup.classList.add('children-group');
                    targetChildrenGroup.dataset.parentOf = targetItemId;
                    currentAddItemTarget.parentNode.insertBefore(targetChildrenGroup, currentAddItemTarget.nextSibling);

                    // Re-attach event listeners for the newly created parent and its new fold arrow
                    // This is handled by attachEventListeners() later
                }

                // Now, add the new item into the targetChildrenGroup
                const newItemHTML = `
                    <div class="item child" data-id="${newItemId}" data-parent-id="${targetItemId}">
                        <label for="${newItemId}-${type}">
                            <input type="${type}" id="${newItemId}-${type}" class="custom-input" ${type === 'radio' ? `name="radio-group-${targetItemId}"` : ''}>
                            <span class="ml-4">New ${type === 'checkbox' ? 'Checkbox' : 'Radio'} Item</span>
                        </label>
                        <span class="item-quantity"></span>
                        <svg class="item-add-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                    </div>
                `;

                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = newItemHTML.trim();
                const newItemElement = tempDiv.firstChild;

                targetChildrenGroup.appendChild(newItemElement);

                // Ensure the parent is expanded if it was collapsed
                if (targetChildrenGroup.classList.contains('collapsed')) {
                    toggleParentFolding(currentAddItemTarget);
                }

                attachEventListeners(); // Re-attach listeners for new and existing items
                updateHideCheckedCount();
            }

            /**
             * Updates the count of checked items and the text of the hide/show button.
             */
            function updateHideCheckedCount() {
                const allCheckboxes = document.querySelectorAll('.item input[type="checkbox"]');
                const checkedCount = Array.from(allCheckboxes).filter(input => input.checked).length;
                const uncheckedCount = Array.from(allCheckboxes).filter(input => !input.checked).length;

                // Update summary values (dummy for now)
                document.querySelector('.summary-col:nth-child(1) .summary-value').textContent = `$ ${formatNumber(uncheckedCount * 1000)}`; // Example dummy value
                document.querySelector('.summary-col:nth-child(2) .summary-value').textContent = `$ ${formatNumber(checkedCount * 500)}`; // Example dummy value
                document.querySelector('.summary-col:nth-child(3) .summary-value').textContent = `$ ${formatNumber((uncheckedCount * 1000) + (checkedCount * 500))}`; // Example dummy value


                if (checkedItemsHidden) {
                    hideCheckedText.textContent = `(${checkedCount}) Show checked items`;
                } else {
                    hideCheckedText.textContent = `(${checkedCount}) Hide checked items`;
                }
            }

            /**
             * Formats a number as a currency string.
             * @param {number} num The number to format.
             * @returns {string} The formatted currency string.
             */
            function formatNumber(num) {
                return num.toLocaleString('es-CL', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            }
        });
    </script>
</body>
</html>
